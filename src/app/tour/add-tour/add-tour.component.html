<div class="modal fade" id="addTourModal" tabindex="-1" aria-labelledby="addTourModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">

      <!-- Modern Header with Gradient -->
      <div class="modal-header bg-gradient border-0 text-white"
        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div>
          <h5 class="modal-title fw-bold mb-1 text-dark" id="addTourModalLabel">
            Add Tour
          </h5>
          <small class="text-dark">Create a memorable travel experience</small>
        </div>
        <button type="button" class="btn-close btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body p-4">
        <form #tourForm="ngForm" (ngSubmit)="onSubmit()">

          <!-- Customized Tour Toggle -->
          <div class="card bg-light border-0 mb-3 p-2">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h6 class="mb-0 fw-semibold fs-6">
                  <i class="bi bi-person-check text-primary me-2"></i>Customized Tour
                </h6>
                <small class="text-muted" style="font-size: 0.8rem;">Create a personalized tour for a specific
                  customer</small>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="isCustomizedToggle"
                  [(ngModel)]="isCustomizedTour" name="isCustomizedToggle"
                  style="width: 2.5em; height: 1.25em; cursor: pointer;">
              </div>
            </div>
          </div>

          <div class="row g-3">

            <!-- Title -->
            <div class="col-12">
              <label for="title" class="form-label fw-semibold small">
                <i class="bi bi-type text-primary me-1"></i>Tour Title
                <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control form-control-sm border-2" id="title" name="title"
                [(ngModel)]="tourData.title" #title="ngModel" required minlength="3"
                placeholder="e.g., Amazing Kerala Backwaters Tour"
                [class.is-invalid]="title.invalid && (title.dirty || title.touched)"
                [class.is-valid]="title.valid && (title.dirty || title.touched)">
              <div class="invalid-feedback" *ngIf="title.invalid && (title.dirty || title.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="title.errors?.['required']">Title is required</span>
                <span *ngIf="title.errors?.['minlength']">Title must be at least 3 characters</span>
              </div>
            </div>

            <!-- Description -->
            <div class="col-12">
              <label for="description" class="form-label fw-semibold small">
                <i class="bi bi-card-text text-primary me-1"></i>Description
                <span class="text-danger">*</span>
              </label>
              <textarea class="form-control form-control-sm border-2" id="description" name="description"
                [(ngModel)]="tourData.description" #description="ngModel" required minlength="10" rows="3"
                placeholder="Describe the tour highlights, activities, and what makes it special..."
                [class.is-invalid]="description.invalid && (description.dirty || description.touched)"
                [class.is-valid]="description.valid && (description.dirty || description.touched)"></textarea>
              <div class="invalid-feedback" *ngIf="description.invalid && (description.dirty || description.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="description.errors?.['required']">Description is required</span>
                <span *ngIf="description.errors?.['minlength']">Description must be at least 10 characters</span>
              </div>
            </div>

            <!-- Destination & Nights -->
            <div class="col-md-6">
              <label for="destinationId" class="form-label fw-semibold small">
                <i class="bi bi-geo-alt text-primary me-1"></i>Destination
                <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select-sm border-2" id="destinationId" name="destinationId"
                [(ngModel)]="tourData.destinationId" #destinationId="ngModel" required
                [class.is-invalid]="destinationId.invalid && (destinationId.dirty || destinationId.touched)"
                [class.is-valid]="destinationId.valid && (destinationId.dirty || destinationId.touched)">
                <option value="" disabled selected>Select destination</option>
                <option *ngFor="let dest of destinations" [value]="dest.id">{{ dest.name }}</option>
              </select>
              <div class="invalid-feedback"
                *ngIf="destinationId.invalid && (destinationId.dirty || destinationId.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>Destination is required
              </div>
            </div>

            <div class="col-md-6">
              <label for="noOfNights" class="form-label fw-semibold small">
                <i class="bi bi-moon-stars text-primary me-1"></i>Number of Nights
                <span class="text-danger">*</span>
              </label>
              <input type="number" class="form-control form-control-sm border-2" id="noOfNights" name="noOfNights"
                [(ngModel)]="tourData.noOfNights" (ngModelChange)="calculateArrivalDate()" #noOfNights="ngModel"
                required min="1" placeholder="e.g., 5"
                [class.is-invalid]="noOfNights.invalid && (noOfNights.dirty || noOfNights.touched)"
                [class.is-valid]="noOfNights.valid && (noOfNights.dirty || noOfNights.touched)">
              <div class="invalid-feedback" *ngIf="noOfNights.invalid && (noOfNights.dirty || noOfNights.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="noOfNights.errors?.['required']">Number of nights is required</span>
                <span *ngIf="noOfNights.errors?.['min']">Must be at least 1 night</span>
              </div>
            </div>

            <!-- Price -->
            <div class="col-md-6">
              <label for="price" class="form-label fw-semibold small">
                <i class="bi bi-currency-dollar text-primary me-1"></i>Price (â‚¹)
                <span class="text-danger">*</span>
              </label>
              <div class="input-group input-group-sm">
                <span class="input-group-text border-2 bg-light">
                  <i class="bi bi-cash"></i>
                </span>
                <input type="number" class="form-control border-2" id="price" name="price" [(ngModel)]="tourData.price"
                  #price="ngModel" required min="0.01" step="0.01" placeholder="0.00"
                  [class.is-invalid]="price.invalid && (price.dirty || price.touched)"
                  [class.is-valid]="price.valid && (price.dirty || price.touched)">
              </div>
              <div class="invalid-feedback d-block" *ngIf="price.invalid && (price.dirty || price.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="price.errors?.['required']">Price is required</span>
                <span *ngIf="price.errors?.['min']">Price must be greater than 0</span>
              </div>
            </div>

            <!-- Departure Date -->
            <div class="col-md-6">
              <label for="departureDate" class="form-label fw-semibold small">
                <i class="bi bi-calendar-event text-primary me-1"></i>Departure Date
                <span class="text-danger">*</span>
              </label>
              <input type="date" class="form-control form-control-sm border-2" id="departureDate" name="departureDate"
                [(ngModel)]="tourData.departureDate" (ngModelChange)="calculateArrivalDate()" #departureDate="ngModel"
                required [min]="minDepartureDate"
                [class.is-invalid]="departureDate.invalid && (departureDate.dirty || departureDate.touched)"
                [class.is-valid]="departureDate.valid && (departureDate.dirty || departureDate.touched)">
              <div class="invalid-feedback"
                *ngIf="departureDate.invalid && (departureDate.dirty || departureDate.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="departureDate.errors?.['required']">Departure date is required</span>
              </div>
            </div>

            <!-- Arrival Date (Auto-calculated) -->
            <div class="col-md-6">
              <label for="arrivalDate" class="form-label fw-semibold small">
                <i class="bi bi-calendar-check text-primary me-1"></i>Arrival Date
              </label>
              <input type="date" class="form-control form-control-sm border-2 bg-light" id="arrivalDate"
                name="arrivalDate" [(ngModel)]="tourData.arrivalDate" disabled>
              <small class="text-muted" style="font-size: 0.75rem;">
                <i class="bi bi-info-circle me-1"></i>Auto-calculated based on departure date and nights
              </small>
            </div>


            <!-- Consultant -->
            <!-- <div class="col-md-6">
              <label for="consultant" class="form-label fw-semibold small">
                <i class="bi bi-person-badge text-primary me-1"></i>Consultant
                <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select-sm border-2" id="consultant" name="consultant"
                [(ngModel)]="tourData.consultantId" #consultant="ngModel" required
                [class.is-invalid]="consultant.invalid && (consultant.dirty || consultant.touched)"
                [class.is-valid]="consultant.valid && (consultant.dirty || consultant.touched)">
                <option value="" disabled selected>Select consultant</option>
                <option *ngFor="let cons of filteredConsultants" [value]="cons.id">
                  {{ cons.userName }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="consultant.invalid && (consultant.dirty || consultant.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>Consultant is required
              </div>
            </div> -->

            <!-- Customer Selection (Conditional) -->
            <div class="col-md-6" *ngIf="isCustomizedTour">
              <div class="alert alert-info border-0 d-flex align-items-center py-2">
                <i class="bi bi-info-circle-fill me-2"></i>
                <small>This tour will be customized for the selected customer</small>
              </div>
              <label for="customizedFor" class="form-label fw-semibold small">
                <i class="bi bi-person text-primary me-1"></i>Customer
                <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select-sm border-2" id="customizedFor" name="customizedFor"
                [(ngModel)]="tourData.customerId" #customizedFor="ngModel" [required]="isCustomizedTour"
                [class.is-invalid]="customizedFor.invalid && (customizedFor.dirty || customizedFor.touched)"
                [class.is-valid]="customizedFor.valid && (customizedFor.dirty || customizedFor.touched)">
                <option value="" disabled selected>Select customer</option>
                <option *ngFor="let cust of customers" [value]="cust.id">{{ cust.userName }}</option>
              </select>
              <div class="invalid-feedback"
                *ngIf="customizedFor.invalid && (customizedFor.dirty || customizedFor.touched)">
                <i class="bi bi-exclamation-circle me-1"></i>Customer selection is required for customized tours
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoading" class="text-center my-3">
            <div class="spinner-border text-primary" style="width: 2rem; height: 2rem;" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted fw-semibold small">
              <i class="bi bi-cloud-upload me-2"></i>Creating your tour...
            </p>
          </div>

          <!-- Error Message -->
          <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mt-3 py-2" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Error:</strong> {{ errorMessage }}
            <button type="button" class="btn-close" (click)="errorMessage = null"></button>
          </div>

        </form>
      </div>

      <!-- Modern Footer -->
      <div class="modal-footer border-0 bg-light px-4 py-3">
        <button type="button" class="btn btn-light rounded-pill px-3" data-bs-dismiss="modal" [disabled]="isLoading">
          <i class="bi bi-x-lg me-2"></i>Cancel
        </button>
        <button type="button" class="btn btn-primary rounded-pill px-3 shadow-sm" (click)="onSubmit()"
          [disabled]="!tourForm.form.valid || isLoading"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i *ngIf="!isLoading" class="bi bi-check-lg me-2"></i>
          {{ isLoading ? 'Creating...' : 'Create Tour' }}
        </button>
      </div>

    </div>
  </div>
</div>